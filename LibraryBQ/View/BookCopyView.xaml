<!-- 
    BookQueryViewModel에서 선택한 도서 정보를 인자로 BookCopyViewModel을 팩토리로 생성
    WindowService를 통해 DI 컨테이너에서 BookCopyView를 생성, ViewModel과 DataContext 연결 후 ShowDialog() 호출 
    -->
    <Window x:Class="LibraryBQ.View.BookCopyView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:LibraryBQ.View"
        xmlns:services="clr-namespace:LibraryBQ.Service"
        mc:Ignorable="d"
        WindowStartupLocation="CenterScreen"
        Title="BookCopyView" Height="350" Width="450">
    <Window.Resources>
        <!-- Bool 값을 Visibility로 변환하는 컨버터 등록 -->
        <services:BooleanToVisibilityConverter x:Key="BoolVisibilityConverter"/>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <!-- 도서 정보 및 대출/예약 버튼 영역 -->
            <RowDefinition Height="2*"/>
            <!-- 도서 부수 목록을 표시하는 DataGrid 영역 -->
            <RowDefinition Height="3*"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="3*"/>
            <ColumnDefinition Width="2*"/>
        </Grid.ColumnDefinitions>

        <!-- 좌측 상단 도서 정보 및 대출/예약 버튼 영역
            - 도서 제목, 저자, 도서번호를 TextBlock으로 표시
            - 로그인된 사용자만 보이는 대출/예약 버튼 배치
            - 대출/예약 버튼은 선택된 복사본(BookCopy)을 CommandParameter로 전달
        -->
        <StackPanel Grid.Row="0" Grid.Column="0" Margin="10" Orientation="Vertical">
            <TextBlock x:Name="QueriedBookTitle" d:Text="제목" Text="{Binding SelectedBook.Title}" Margin="0,3" FontSize="18" FontWeight="SemiBold" Foreground="DarkBlue" VerticalAlignment="Center"/>
            <TextBlock x:Name="QueriedBookAuthor" d:Text="저자" Text="{Binding SelectedBook.Author}" Margin="0,1" FontSize="15" VerticalAlignment="Center"/>
            <TextBlock x:Name="QueriedBookNum" d:Text="도서번호" Text="{Binding SelectedBook.Id}" Margin="0,1" FontSize="15" VerticalAlignment="Center"/>
            <Button x:Name="Loanbtn" Content="대출/예약" Command="{Binding LoanbtnClickCommand}" CommandParameter="{Binding SelectedItem, ElementName=gridBookCopy}"
                    Visibility="{Binding LoginUserAccount.IsLogin, Converter={StaticResource BoolVisibilityConverter}}"
                    Margin="0, 10, 120, -10" FontSize="15" Foreground="White" Background="DarkBlue"/>
        </StackPanel>

        <!-- 우측 상단 도서 이미지 영역
            - 책 표지 이미지를 고정 높이로 배치
            - 이미지 크기 자동 조정 (너비 auto)
        -->
        <StackPanel Grid.Row="0" Grid.Column="1" Margin="10" Orientation="Vertical">
            <Image HorizontalAlignment="Left" Source="/Image/cover.jpg" Height="110" Width="auto"/>
        </StackPanel>

        <!-- 하단 도서 부수 목록 DataGrid
            - 도서 복사본(BookCopy)들의 리스트를 바인딩된 컬렉션(BookCopies)으로 표시
            - 컬럼에는 분류번호, 현재 도서 상태, 예약자 수, 반납 예정일 정보 포함
            - Id 컬럼은 내부 식별용으로 숨김(Hidden)
            - 단일 선택 모드, 읽기 전용으로 설정하여 목록 조회 용도로 사용
            - DataGrid 스타일로 헤더 색상과 폰트 지정, 가독성 향상
        -->
        <DataGrid x:Name="gridBookCopy" ItemsSource="{Binding BookCopies, UpdateSourceTrigger=PropertyChanged}"
                  Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" AutoGenerateColumns="False" IsReadOnly="True" SelectionMode="Single" FontSize="12">
            <DataGrid.ColumnHeaderStyle>
                <Style TargetType="DataGridColumnHeader">
                    <Setter Property="Foreground" Value="Gray"/>
                    <Setter Property="FontSize" Value="15"/>
                    <Setter Property="FontWeight" Value="SemiBold"/>
                </Style>
            </DataGrid.ColumnHeaderStyle>
            <DataGrid.Columns>
                <DataGridTextColumn Header="Id" Binding="{Binding BookId}" Width="*" Visibility="Hidden"/>
                <DataGridTextColumn Header="등록번호" Binding="{Binding ClassificationNumber}" Width="2*"/>
                <DataGridTextColumn Header="도서상태" Binding="{Binding CurrentStatusName}" Width="1.2*"/>
                <DataGridTextColumn Header="예약자수" Binding="{Binding CurrentReservations.Count}" Width="1.2*"/>
                <DataGridTextColumn Header="반납예정일" Binding="{Binding CurrentLoanDueDate, StringFormat={}{0:yyyy-MM-dd}}" Width="2*"/>
            </DataGrid.Columns>
        </DataGrid>
    </Grid>
</Window>
